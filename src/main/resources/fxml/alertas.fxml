<?xml version="1.0" encoding="UTF-8"?>
<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.control.cell.PropertyValueFactory?>

<BorderPane xmlns:fx="http://javafx.com/fxml"
            fx:controller="com.avitech.sia.iu.AlertasController">

    <!-- ========== SIDEBAR (scroll propio) ========== -->
    <left>
        <ScrollPane fitToWidth="true" hbarPolicy="NEVER" prefWidth="270" styleClass="side-scroll">
            <content>
                <VBox fx:id="sidebar" spacing="10" styleClass="sidebar" prefWidth="270">
                    <children>

                        <Label text="Menú Principal" styleClass="sidebar-title"/>

                        <fx:define>
                            <ToggleGroup fx:id="sideGroup"/>
                        </fx:define>

                        <ToggleButton text="Tablero"       toggleGroup="$sideGroup" onAction="#goDashboard"  styleClass="side-btn"/>
                        <ToggleButton text="Suministros"   toggleGroup="$sideGroup" onAction="#goSupplies"   styleClass="side-btn"/>
                        <ToggleButton text="Sanidad"       toggleGroup="$sideGroup" onAction="#goHealth"     styleClass="side-btn"/>
                        <ToggleButton text="Producción"    toggleGroup="$sideGroup" onAction="#goProduction" styleClass="side-btn"/>
                        <ToggleButton text="Reportes"      toggleGroup="$sideGroup" onAction="#goReports"    styleClass="side-btn"/>
                        <ToggleButton text="Alertas"       toggleGroup="$sideGroup" selected="true"          styleClass="side-btn active"/>
                        <ToggleButton text="Auditoría"     toggleGroup="$sideGroup" onAction="#goAudit"      styleClass="side-btn"/>
                        <ToggleButton text="Parámetros"    toggleGroup="$sideGroup" onAction="#goParams"     styleClass="side-btn"/>
                        <ToggleButton text="Usuarios"      toggleGroup="$sideGroup" onAction="#goUsers"      styleClass="side-btn"/>
                        <ToggleButton text="Respaldos"     toggleGroup="$sideGroup" onAction="#goBackup"     styleClass="side-btn"/>

                        <Region VBox.vgrow="ALWAYS"/>

                        <Label text="Usuario del sistema" styleClass="sidebar-subtitle"/>
                        <Label fx:id="lblUserInfo" text="Administrador" styleClass="sidebar-user"/>

                        <Button text="Cerrar sesión" onAction="#onExit" styleClass="side-logout"/>
                    </children>

                    <padding>
                        <Insets top="16" right="16" bottom="16" left="16"/>
                    </padding>
                </VBox>
            </content>
        </ScrollPane>
    </left>

    <!-- ========== TOP BAR ========== -->
    <top>
        <HBox spacing="12" styleClass="topbar">
            <children>
                <Label text="AVITECH — SIA" styleClass="topbar-brand"/>
                <Pane HBox.hgrow="ALWAYS"/>
                <Label fx:id="lblSystemStatus" text="Sistema Offline – MySQL Local" styleClass="topbar-status"/>
                <Separator orientation="VERTICAL"/>
                <Label fx:id="lblHeader" text="Administrador"/>
                <Button text="↻ Actualizar" onAction="#onRefresh" styleClass="ghostBtn"/>
                <Button text="↩ Salir" onAction="#onExit" styleClass="ghostBtn"/>
            </children>
            <padding><Insets topRightBottomLeft="10"/></padding>
        </HBox>
    </top>

    <!-- ========== CONTENIDO (scroll propio) ========== -->
    <center>
        <ScrollPane fitToWidth="true" hbarPolicy="NEVER">
            <content>
                <VBox spacing="18" styleClass="content">
                    <padding><Insets topRightBottomLeft="16"/></padding>
                    <children>

                        <Label text="Alertas de Stock" styleClass="h2"/>
                        <Label text="Monitoreo de artículos con stock por debajo del mínimo" styleClass="helper"/>

                        <!-- Banner de atención inmediata -->
                        <HBox spacing="10" styleClass="card" alignment="CENTER_LEFT">
                            <children>
                                <Label fx:id="lblBanner" text="3 artículo(s) en stock crítico requieren atención inmediata" style="-fx-font-weight: 700;"/>
                                <Pane HBox.hgrow="ALWAYS"/>
                                <Button text="Ver Críticos" onAction="#onVerCriticos" styleClass="secondary"/>
                            </children>
                        </HBox>

                        <!-- KPIs -->
                        <HBox spacing="12">
                            <children>
                                <VBox styleClass="card" prefWidth="220">
                                    <children>
                                        <Label text="Stock Crítico" styleClass="card-title"/>
                                        <Label fx:id="kpiCritico" text="0" styleClass="card-kpi"/>
                                    </children>
                                </VBox>
                                <VBox styleClass="card" prefWidth="220">
                                    <children>
                                        <Label text="Stock Bajo" styleClass="card-title"/>
                                        <Label fx:id="kpiBajo" text="0" styleClass="card-kpi"/>
                                    </children>
                                </VBox>
                                <VBox styleClass="card" prefWidth="220">
                                    <children>
                                        <Label text="Advertencias" styleClass="card-title"/>
                                        <Label fx:id="kpiAdv" text="0" styleClass="card-kpi"/>
                                    </children>
                                </VBox>
                                <VBox styleClass="card" prefWidth="220">
                                    <children>
                                        <Label text="Total Alertas" styleClass="card-title"/>
                                        <Label fx:id="kpiTotal" text="0" styleClass="card-kpi"/>
                                    </children>
                                </VBox>
                            </children>
                        </HBox>

                        <!-- Filtros -->
                        <HBox spacing="10" styleClass="card" alignment="CENTER_LEFT">
                            <children>
                                <TextField fx:id="txtSearch" promptText="Buscar por artículo, categoría o ubicación…" HBox.hgrow="ALWAYS"/>
                                <ComboBox fx:id="cbCategoria" promptText="Todas las categorías" prefWidth="180"/>
                                <ComboBox fx:id="cbCriticidad" promptText="Todas las criticidad" prefWidth="180"/>
                                <ComboBox fx:id="cbUbicacion" promptText="Todas las ubicaciones" prefWidth="180"/>
                                <Button text="Aplicar" onAction="#onAplicarFiltros" styleClass="primary"/>
                                <Button text="Limpiar" onAction="#onLimpiarFiltros" styleClass="ghostBtn"/>
                            </children>
                        </HBox>

                        <!-- Tabla principal -->
                        <VBox spacing="10" styleClass="card">
                            <children>
                                <HBox alignment="CENTER_LEFT">
                                    <children>
                                        <Label text="Artículos con Stock Bajo" styleClass="card-title"/>
                                        <Label fx:id="lblCantidadTabla" text="(0)" styleClass="helper" style="-fx-padding: 0 0 0 6;"/>
                                        <Pane HBox.hgrow="ALWAYS"/>
                                        <Label fx:id="lblActualizado" text="" styleClass="helper"/>
                                    </children>
                                </HBox>

                                <TableView fx:id="tblAlertas" prefHeight="420">
                                    <columns>
                                        <TableColumn fx:id="colArticulo"   text="Artículo"      prefWidth="220"/>
                                        <TableColumn fx:id="colCategoria"  text="Categoría"    prefWidth="130"/>
                                        <TableColumn fx:id="colStockActual" text="Stock Actual" prefWidth="110"/>
                                        <TableColumn fx:id="colStockMin"    text="Stock Mínimo" prefWidth="110"/>
                                        <TableColumn fx:id="colPorcentaje"  text="Stock (%)"      prefWidth="90"/>
                                        <TableColumn fx:id="colDias"        text="Días Restantes" prefWidth="120"/>
                                        <TableColumn fx:id="colUbicacion"   text="Ubicación"    prefWidth="160"/>
                                        <TableColumn fx:id="colAccion"      text="Acción"       prefWidth="100"/>
                                    </columns>
                                    <placeholder>
                                        <Label text="Tabla sin contenido" styleClass="helper"/>
                                    </placeholder>
                                </TableView>
                            </children>
                        </VBox>

                        <!-- Acciones rápidas + Resumen -->
                        <HBox spacing="12">
                            <children>
                                <VBox spacing="8" styleClass="card" prefWidth="520">
                                    <children>
                                        <Label text="Acciones Rápidas" styleClass="card-title"/>
                                        <Button text="Ir a Gestión de Suministros" onAction="#goSupplies" styleClass="secondary"/>
                                        <Button text="Ver Solo Artículos Críticos" onAction="#onVerCriticos" styleClass="secondary"/>
                                        <Button text="Actualizar Lista de Alertas" onAction="#onRefresh" styleClass="secondary"/>
                                    </children>
                                </VBox>

                                <VBox spacing="8" styleClass="card" VBox.vgrow="NEVER">
                                    <children>
                                        <Label text="Resumen por Criticidad" styleClass="card-title"/>
                                        <Label fx:id="lblResCritico"     text="Crítico — 0 artículos"     />
                                        <Label fx:id="lblResBajo"        text="Bajo — 0 artículos"        />
                                        <Label fx:id="lblResAdvertencia" text="Advertencia — 0 artículos" />
                                    </children>
                                </VBox>
                            </children>
                        </HBox>

                    </children>
                </VBox>
            </content>
        </ScrollPane>
    </center>

</BorderPane>
