<?xml version="1.0" encoding="UTF-8"?>
<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.text.Text?>

<BorderPane xmlns:fx="http://javafx.com/fxml"
            fx:id="rootPane"
            fx:controller="com.avitech.sia.iu.suministros.SuministrosController"
            stylesheets="@/css/theme.css">

    <!-- ========== SIDEBAR ========== -->
    <left>
        <ScrollPane fitToWidth="true" hbarPolicy="NEVER" prefWidth="270" styleClass="side-scroll">
            <content>
                <VBox spacing="10" styleClass="sidebar" prefWidth="270">
                    <children>
                        <Label text="Menú Principal" styleClass="sidebar-title"/>
                        <fx:define><ToggleGroup fx:id="sideGroup"/></fx:define>

                        <ToggleButton text="Tablero"     toggleGroup="$sideGroup" onAction="#goDashboard"  styleClass="side-btn"/>
                        <ToggleButton text="Suministros" toggleGroup="$sideGroup" onAction="#goSupplies"   styleClass="side-btn active" selected="true"/>
                        <ToggleButton text="Sanidad"     toggleGroup="$sideGroup" onAction="#goHealth"     styleClass="side-btn"/>
                        <ToggleButton text="Producción"  toggleGroup="$sideGroup" onAction="#goProduction" styleClass="side-btn"/>
                        <ToggleButton text="Reportes"    toggleGroup="$sideGroup" onAction="#goReports"    styleClass="side-btn"/>
                        <ToggleButton text="Alertas"     toggleGroup="$sideGroup" onAction="#goAlerts"     styleClass="side-btn"/>
                        <ToggleButton text="Auditoría"   toggleGroup="$sideGroup" onAction="#goAudit"      styleClass="side-btn"/>
                        <ToggleButton text="Parámetros"  toggleGroup="$sideGroup" onAction="#goParams"     styleClass="side-btn"/>
                        <ToggleButton text="Usuarios"    toggleGroup="$sideGroup" onAction="#goUsers"      styleClass="side-btn"/>
                        <ToggleButton text="Respaldos"   toggleGroup="$sideGroup" onAction="#goBackup"     styleClass="side-btn"/>

                        <Region VBox.vgrow="ALWAYS"/>
                        <Label text="Usuario del sistema" styleClass="sidebar-subtitle"/>
                        <Label fx:id="lblUserInfo" text="Administrador" styleClass="sidebar-user"/>
                        <Button text="Cerrar sesión" onAction="#onExit" styleClass="side-logout"/>
                    </children>
                    <padding><Insets topRightBottomLeft="16"/></padding>
                </VBox>
            </content>
        </ScrollPane>
    </left>

    <!-- ========== TOP BAR ========== -->
    <top>
        <HBox spacing="12" styleClass="topbar">
            <children>
                <Label text="AVITECH — SIA" styleClass="topbar-brand"/>
                <Pane HBox.hgrow="ALWAYS"/>
                <Label fx:id="lblSystemStatus" text="Sistema Offline – MySQL Local" styleClass="topbar-status"/>
                <Separator orientation="VERTICAL"/>
                <Label fx:id="lblHeader" text="Administrador"/>
                <Button text="↩ Salir" onAction="#onExit" styleClass="ghostBtn"/>
            </children>
            <padding><Insets topRightBottomLeft="10"/></padding>
        </HBox>
    </top>

    <!-- ========== CONTENT (con host para modales) ========== -->
    <center>
        <!-- IMPORTANTE: este StackPane permite mostrar los modales con overlay sin cubrir el sidebar -->
        <StackPane fx:id="overlayHost">

            <!-- Contenido normal -->
            <ScrollPane fitToWidth="true" hbarPolicy="NEVER">
                <content>
                    <VBox spacing="18" styleClass="content">
                        <children>
                            <Label text="Suministros y Alimentos" styleClass="h2"/>
                            <Label text="Gestión de stock, entradas y salidas de productos" styleClass="helper"/>

                            <!-- KPIs -->
                            <HBox spacing="12">
                                <children>
                                    <VBox styleClass="card" prefWidth="280" minWidth="0" maxWidth="Infinity" HBox.hgrow="ALWAYS">
                                        <children>
                                            <Label text="Movimientos Hoy" styleClass="card-title"/>
                                            <Label fx:id="kpiMovHoy" text="0" styleClass="card-kpi"/>
                                            <Label text="+0" styleClass="card-delta"/>
                                        </children>
                                    </VBox>
                                    <VBox styleClass="card" prefWidth="280" minWidth="0" maxWidth="Infinity" HBox.hgrow="ALWAYS">
                                        <children>
                                            <Label text="Productos Activos" styleClass="card-title"/>
                                            <Label fx:id="kpiActivos" text="0" styleClass="card-kpi"/>
                                            <Label text="+0" styleClass="card-delta"/>
                                        </children>
                                    </VBox>
                                    <VBox styleClass="card" prefWidth="280" minWidth="0" maxWidth="Infinity" HBox.hgrow="ALWAYS">
                                        <children>
                                            <Label text="Stock Bajo" styleClass="card-title"/>
                                            <Label fx:id="kpiStockBajo" text="0" styleClass="card-kpi"/>
                                            <Label text="+0" styleClass="card-delta bad"/>
                                        </children>
                                    </VBox>
                                    <VBox styleClass="card" prefWidth="280" minWidth="0" maxWidth="Infinity" HBox.hgrow="ALWAYS">
                                        <children>
                                            <Label text="Valor Total Stock" styleClass="card-title"/>
                                            <Label fx:id="kpiValor" text="+$0" styleClass="card-kpi"/>
                                            <Label text="+$0" styleClass="card-delta"/>
                                        </children>
                                    </VBox>
                                </children>
                            </HBox>

                            <!-- Acciones principales -->
                            <HBox spacing="10">
                                <children>
                                    <Button text="⬇ Entrada" styleClass="primary"   onAction="#onEntrada"/>
                                    <Button text="⬆ Salida"  styleClass="secondary" onAction="#onSalida"/>
                                    <Button text="👁 Ver Stock" styleClass="secondary" onAction="#onVerStock"/>
                                </children>
                            </HBox>

                            <!-- Filtros -->
                            <VBox styleClass="card">
                                <children>
                                    <Label text="Filtros y Búsqueda" styleClass="card-title"/>
                                    <GridPane hgap="10" vgap="10">
                                        <columnConstraints>
                                            <ColumnConstraints percentWidth="30"/>
                                            <ColumnConstraints percentWidth="17.5"/>
                                            <ColumnConstraints percentWidth="17.5"/>
                                            <ColumnConstraints percentWidth="17.5"/>
                                            <ColumnConstraints percentWidth="17.5"/>
                                        </columnConstraints>

                                        <Label text="Buscar" GridPane.columnIndex="0"/>
                                        <TextField fx:id="txtSearch" promptText="Ítem, responsable o proveedor…" GridPane.columnIndex="0"/>

                                        <Label text="Tipo de Movimiento" GridPane.columnIndex="1"/>
                                        <ComboBox fx:id="cbTipo" GridPane.columnIndex="1"/>

                                        <Label text="Responsable" GridPane.columnIndex="2"/>
                                        <ComboBox fx:id="cbResp" GridPane.columnIndex="2"/>

                                        <Label text="Fecha Desde" GridPane.columnIndex="3"/>
                                        <DatePicker fx:id="dpDesde" GridPane.columnIndex="3"/>

                                        <Label text="Fecha Hasta" GridPane.columnIndex="4"/>
                                        <DatePicker fx:id="dpHasta" GridPane.columnIndex="4"/>
                                    </GridPane>

                                    <HBox spacing="10" style="-fx-padding: 8 0 0 0;">
                                        <children>
                                            <Button text="Mover Stock" onAction="#onMoverStock" styleClass="ghostBtn"/>
                                            <Pane HBox.hgrow="ALWAYS"/>
                                            <Label text="Mostrando" styleClass="helper"/>
                                            <Label fx:id="lblMostrando" text="0 ítems" styleClass="helper"/>
                                        </children>
                                    </HBox>
                                </children>
                            </VBox>

                            <!-- Tabla de movimientos -->
                            <VBox styleClass="card">
                                <children>
                                    <Label text="Historial de Movimientos de Stock" styleClass="card-title"/>
                                    <Label text="Registro completo de entradas y salidas" styleClass="helper"/>
                                    <TableView fx:id="tblMovs" prefHeight="380">
                                        <columns>
                                            <TableColumn fx:id="colFecha" text="Fecha/Hora" prefWidth="145"/>
                                            <TableColumn fx:id="colItem"  text="Ítem" prefWidth="200"/>
                                            <TableColumn fx:id="colCant"  text="Cantidad" prefWidth="90"/>
                                            <TableColumn fx:id="colUnidad" text="Unidad" prefWidth="70"/>
                                            <TableColumn fx:id="colTipo" text="Tipo (E/S)" prefWidth="90"/>
                                            <TableColumn fx:id="colResp" text="Responsable" prefWidth="150"/>
                                            <TableColumn fx:id="colDet"  text="Detalles" prefWidth="380"/>
                                            <TableColumn fx:id="colStock" text="Stock" prefWidth="140"/>
                                            <TableColumn fx:id="colAccion" text="Acciones" prefWidth="100"/>
                                        </columns>
                                    </TableView>
                                </children>
                            </VBox>

                        </children>
                        <padding><Insets topRightBottomLeft="16"/></padding>
                    </VBox>
                </content>
            </ScrollPane>

            <!-- Aquí se inyectarán los modales: entrada/salida/stock/mover -->
            <Pane fx:id="modalLayer" pickOnBounds="false"/>
        </StackPane>
    </center>

</BorderPane>
